package th.ac.kmitl.it.prip.fractal.decompression.audio;

import static org.junit.Assert.*;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.Collection;
import java.util.List;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;

import th.ac.kmitl.it.prip.fractal.Parameters;
import th.ac.kmitl.it.prip.fractal.dataset.DataSetManager;

@RunWith(Parameterized.class)
public class DecompressorTest {
	private int input;
	private double[] expected;

	@Parameterized.Parameters
	public static Collection<Object[]> codeSamplesMap() {
		return Arrays.asList(new Object[][] { { 0, new double[] { 273.90847464851413, 271.7858280537453,
				272.2708632230828, 270.688474017036, 71.84356335873065, 71.45453896303755, 71.54343294760683,
				71.25342329355009, 42.71818402939315, 42.55819884395845, 42.59475624437548, 42.475490592154735,
				25.154126919409315, 25.07678822229153, 24.999002685500077, 24.930417749697597, 24.44178959338122,
				25.65566648618203, 26.774195252209633, 22.845870865253396, 20.55126300562475, 20.82561219479465,
				18.084361194299714, 18.12355210426252, 17.27858139278672, 17.612253641894863, 14.278256594290523,
				14.325921831105877, 14.814854846370832, 15.157993383240695, 11.729410778900048, 11.778428279348745,
				12.713895776238743, 12.790601786583375, 12.773074086584513, 12.830256833400394, 11.030289196536653,
				11.09539312125909, 11.08051655479244, 11.129050186347477, 9.515552530516894, 9.563927785159006,
				9.552873801945358, 9.588936555384434, 7.677526663636413, 7.70454207660068, 7.698368922089638,
				7.718508354615478, 8.197306641945255, 8.184203061977993, 8.175477457466418, 8.176038323035055,
				4.550370293308939, 4.43303018844155, 5.6054728001334455, 5.588710711283109, 3.053446461641315,
				2.871666559181401, 4.687980800881309, 4.662013456811844, 1.9763502178601908, 1.7744504283282059,
				3.7917992009958854, 3.7629577216498076, 0.6920628445666244, 0.4812150481301918, 2.5879708022927677,
				2.5578510959761642, -0.21779613502333445, -0.26315362818801286, -0.2527892182895058,
				-0.28660229286066113, -1.3157350701753334, -1.351483839506346, -1.3433150701837433, -1.3699650395466418,
				-2.090384417036419, -2.111893290936246, -2.1069784076391525, -2.1230128289965213, -2.7308434132946644,
				-2.72584806694243, -2.7218259226953587, -2.719147598140074, -2.871508572317464, -2.7727334591990944,
				-3.7596777927289042, -3.7455677216311893, -3.5449252028659024, -3.360921427142813, -5.1994562368207,
				-5.1731712114156725, -4.129647099061937, -3.9025106848035986, -6.1720195713376595, -6.139573028348391,
				-4.763713869275307, -4.506322302243054, -7.078135591653487, -7.0413670859426905, -6.342584247962105,
				-6.285244717506787, -6.298347081759352, -6.255601645804119, -7.413515865104005, -7.360658471086356,
				-7.372736645155121, -7.333332549362907, -9.172237973892852, -9.135729298287082, -9.144071709924692,
				-9.116855246125205, -11.167527089960634, -11.152725375948624, -11.152896901317726, -11.13976312697111,
				-14.08119669723941, -14.232872130820452, -12.717356683836398, -12.739023590449206, -17.685020579263004,
				-17.99427586547996, -14.904249008409193, -14.948426270657794, -22.829663784994096, -23.30715253634513,
				-18.53616516318582, -18.60437465459737, -29.482831954408695, -30.130778030969164, -23.656609705513706,
				-23.749169105539877, -40.272249810051576, -41.0609688801322, -33.180220456891846, -33.29288934486998,
				-60.978239811393735, -61.885958856617066, -52.816182676794604, -52.945850766868084, -110.15709529680674,
				-125.61336138420343, -125.39238740827678, -138.6986714626812, 9.009326784463005, 9.874312839992301,
				7.052363661502691, 7.785664696971242, 129.12547335474093, 129.32519062338935, 129.5012850056345,
				129.64307237262497, 57.76892438567717, 57.73353792947884, 57.84898346800538, 57.81898422720153,
				35.146954027594454, 34.99826524250563, 35.032241359977036, 34.9213969409557, 24.844597912287483,
				24.708398278882402, 24.739520563870936, 24.637986549542376, 19.200318057671, 19.086596248513896,
				19.112582240293133, 19.02780497979871, 15.188578295059505, 15.105709599035352, 15.124645502971461,
				15.062868601234284, 12.6689972212051, 12.616486213701815, 12.628485236751251, 12.589339364952988,
				8.521844168733173, 8.492787013813784, 8.46356197541425, 8.437793722534144, 9.592218102727829,
				9.681526914896669, 8.78916826987353, 8.801926075454016, 8.914251878307681, 9.087602067908229,
				7.3555161006914425, 7.380279256337084, 7.870352424100905, 8.097488838359244, 5.827979951825182,
				5.860426494814451, 6.695462735061118, 6.94220071597083, 4.476836269021496, 4.512082904972908,
				5.582298290076907, 5.6348911936182775, 5.6228734569220205, 5.6620803805256115, 4.755354538178282,
				4.803085344799934, 4.7921786211232735, 4.82776095187025, 3.8235752403765444, 3.8598194225681652,
				3.8515374489743803, 3.8785567383951234, 2.523107614876599, 2.5403652717852183, 2.536421812444568,
				2.5492870393180183, 4.1700023088734195, 4.154079817765448, 4.143477115252519, 4.14415863717643,
				0.29838434164779726, 0.18052594273532718, 1.3581472614389969, 1.3413111340419581, -0.9465532999401058,
				-1.1283332024000199, 0.6879810392998885, 0.6620136952304234, -2.31248652030662, -2.5245215887282577,
				-0.40590281238161496, -0.4361921210564913, -3.307937036224086, -3.5187848326605184, -1.4120290784979428,
				-1.442148784814546, -4.4617829316597275, -4.506760470218094, -4.4964828818127485, -4.530012708070549,
				-5.315734844519554, -5.351483610912697, -5.343314842261412, -5.36996480943419, -6.338557135136068,
				-6.35995054784373, -6.355062047995974, -6.3710103954187325, -7.537397836596085, -6.127171259746131,
				-6.718300521845027, -9.452480688347215, -8.16284354042853, -8.009613224712247, -9.540664792731624,
				-9.51877577047871, -9.043451538907991, -8.793820680419364, -11.288090274059693, -11.252430389193378,
				-10.716868407875008, -10.382008886781662, -13.727868956570067, -13.680034117396442, -12.558126197811646,
				-12.181839630588954, -15.941631784496966, -15.887879072411843, -15.140056123858283, -15.0541213442863,
				-15.073757863367902, -15.00969525965712, -18.454972242857753, -18.373139645117124, -18.39183879550809,
				-18.330834283646972, -23.483216827435903, -23.41896640068306, -23.433647938672888, -23.38575057223037,
				-29.938607810065758, -31.67702881074542, -33.09968034661318, -34.54522621154676, -43.31411395420259,
				-49.09441181330264, -41.11690792029434, -31.475756022675185, -70.93313998709692, -88.78433100508835,
				-64.14754769180885, -34.372949850467585, -325.40485732669237, -337.9718635775853, -212.40444869759267,
				-214.1996514170573, 333.21404095908264, 335.338274352437, 335.3136582899619, 337.1985212203785,
				85.47306800697437, 85.91369600230381, 85.81301034183817, 86.14148941386534, 49.779884359483034,
				49.98714002271116, 49.93978108601498, 50.09428590334656, 34.537465648068704, 34.634617987332305,
				34.61241820078169, 34.68484326361211, 25.389491881493747, 25.41796210543952, 25.41763218650805,
				25.442894226877026, 19.1430351522644, 18.984635598229893, 20.5673373269605, 20.544709876596617,
				14.978848218805984, 14.712357934598623, 17.375084077205194, 17.337015815491235, 11.820106962416938,
				11.512189632080231, 14.588847858806412, 14.544861724180954, 9.670471687006192, 9.602256406173616,
				9.617843932788539, 9.566990849499525, 7.741402801785334, 7.677669663266165, 7.692232998354653,
				7.644721259608901, 6.458913799848594, 6.408925135086395, 6.420347790434508, 6.383082273066079,
				5.217637339148915, 5.183997392798597, 5.191684285715554, 5.166606400339853, 4.3038363945848035,
				4.2914408301891, 4.29427327751713, 4.285032640215113, 4.0468453516111245, 4.12431329248441,
				3.3502666438768003, 3.3613329754557446, 3.3734289594812648, 3.53612556295927, 1.910488438203584,
				1.9337297240898408, 2.991348241298095, 3.1848183179707132, 1.2516978197861561, 1.2793351107084106,
				2.0729941981602176, 2.2877714470779194, 0.1417532639711621, 0.17243429441218686, 1.5071816881065443,
				1.55502795885823, 1.544094851060915, 1.5797632579326222, 0.43625056056460154, 0.4796146919407499,
				0.46970577499855193, 0.5020328395171202, -0.25154162767635824, -0.22004407533655324,
				-0.22724142070271294, -0.20376064582373282, -1.2464805571057458, -1.2367000681006206,
				-1.8256470893388763, -1.8273241315030462, -2.092453462554803, -2.894847161850156, -1.7874476790057523,
				-0.4491084229378161, -4.32863400870316, -4.4796404511562695, -2.97080945111487, -2.992380792032222,
				-5.569021946630181, -5.782762594269912, -3.647101956957066, -3.677634908420802, -7.186941109237721,
				-7.431455230072066, -4.988311219330349, -5.023240175830082, -8.471228720949867, -8.72469084868866,
				-6.192139856452045, -6.228347039922305, -9.860189594481438, -9.914544931551271, -9.902124470140013,
				-9.942645251546729 } } });
	}

	public DecompressorTest(int input, double[] expectedResult) {
		this.input = input;
		this.expected = expectedResult;
	}

	@Test
	public void testDecompress() throws IOException {
		String fileDir = "test-classes//expected//synth_code//";
		List<String> parameterList = Files.readAllLines(Paths.get("test-classes//input-param.txt"));
		String[] params = new String[parameterList.size()];
		parameterList.toArray(params);
		Parameters testParameters = new Parameters(params);
		testParameters.setParameter("processname", "decompress");
		testParameters.setParameter("fs", "8000");
		testParameters.setParameter("inpathprefix", fileDir);
		testParameters.setParameter("inext", "mat");
		testParameters.setParameter("outext", "raw");
		DataSetManager dataSetManager = new DataSetManager(testParameters);

		double[][] codes = dataSetManager.readCode(input);
		Decompressor decompressor = new Decompressor(codes, testParameters);
		double[] expected = this.expected;
		double[] actual = decompressor.decompress();
		assertArrayEquals(expected, actual, 1e0);
	}

}
